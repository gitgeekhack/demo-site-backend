import io

from app.service.api.v1.insurance_application.extractor_v1 import alliance_united

uuid = '89c5de1c-4d25-11ec-8623-d1e221452fcd'
valid_file = 'app/data/temp/test_data/ALLIANCE_APP_Patricia Lopez.pdf'
invalid_file = 'app/data/temp/test_data/ALLIANCE_APP_Alex Zuniga.pdf'
page_metadata = (
('DATE (MM/DD/YYYY)', (496.00201416015625, 33.07999038696289, 575.4822387695312, 40.98398971557617), 12),
('CANCELLATION REQUEST / POLICY RELEASE', (157.75, 49.23798370361328, 473.2120056152344, 62.985984802246094), 12),
('PHONE (A/C , No, Ext): (909) 723-1900', (132.0, 93.135986328125, 275.4801025390625, 100.99198913574219), 12),
('PRODUCER', (30.0, 95.27802276611328, 81.47100067138672, 104.11602020263672), 12),
('COMPANY NAME AND ADDRESS', (306.0, 95.27802276611328, 449.41497802734375, 104.11602020263672), 12),
('NAIC CODE : 10920', (497.0, 95.27802276611328, 580.4661865234375, 104.11602020263672), 12), (
"Veronica's Auto Insurance Services - Orange S", (28.5, 113.07998657226562, 195.77200317382812, 120.98399353027344),
12), ('Alliance United Insurance Company', (306.0, 119.41999053955078, 476.4296875, 129.239990234375), 12),
('290 W Orangeshow Rd Ste 100', (28.5, 122.27883911132812, 141.3719940185547, 130.18284606933594), 12),
('PO Box 280339,', (306.0, 130.91876220703125, 380.9899597167969, 140.73876953125), 12),
('SAN BERNARDINO', (28.5, 131.47769165039062, 100.45199584960938, 139.38169860839844), 12),
('CA 92408', (28.5, 140.67654418945312, 64.06000518798828, 148.58055114746094), 12),
('Northridge, CA 91328-0339', (306.0, 142.41754150390625, 433.1799011230469, 152.237548828125), 12),
('POLICY', (304.5, 162.26199340820312, 331.98748779296875, 169.67198181152344), 12),
(' Personal Auto', (365.25, 164.16998291015625, 435.74993896484375, 173.989990234375), 12),
('CODE 06398', (30.0, 167.07998657226562, 81.48999786376953, 174.98399353027344), 12),
('SUBCODE', (174.0, 167.07998657226562, 213.5360107421875, 174.98399353027344), 12),
('TYPE', (304.5, 170.88619995117188, 324.0674743652344, 178.2961883544922), 12),
('CANCELLED POLICY INFORMATION', (306.0, 185.07998657226562, 443.6720275878906, 192.98399353027344), 12),
('AGENCY CUSTOMER ID :', (30.0, 185.27801513671875, 139.4039764404297, 194.1160125732422), 12),
('INSURED NAME AND ADDRESS', (30.0, 199.27801513671875, 167.91603088378906, 208.1160125732422), 12),
('MIL4770754', (386.25, 200.77801513671875, 436.7580261230469, 209.6160125732422), 12),
('POLICY NUMBER', (306.0, 201.07998657226562, 372.176025390625, 208.98399353027344), 12),
('PATRICIA LOPEZ', (29.75, 212.32998657226562, 95.02198028564453, 220.23399353027344), 12),
('EFFECTIVE DATE', (306.0, 215.01303100585938, 369.2624816894531, 222.4230194091797), 12),
('CANCELLATION DATE', (384.0, 217.07998657226562, 468.83209228515625, 224.98399353027344), 12),
('TIME', (489.0, 217.07998657226562, 508.09600830078125, 224.98399353027344), 12),
('AM', (569.25, 219.32998657226562, 581.2420043945312, 227.23399353027344), 12),
('7609 PIONEER BLVD', (29.75, 221.52920532226562, 108.82198333740234, 229.43321228027344), 12),
('AND HOUR OF', (306.0, 223.63723754882812, 358.46246337890625, 231.04722595214844), 12),
('WHITTIER', (29.75, 230.72842407226562, 68.36600494384766, 238.63243103027344), 12),
('PM', (570.0, 232.07998657226562, 581.9920043945312, 239.98399353027344), 12),
('CANCELLATION', (306.0, 232.26144409179688, 363.4650573730469, 239.6714324951172), 12),
('CA 90606-2118', (29.75, 239.92764282226562, 85.76599884033203, 247.83164978027344), 12),
('POLICY TERM', (314.135009765625, 247.07998657226562, 368.31103515625, 254.98399353027344), 12),
('EFFECTIVE DATE', (398.218994140625, 247.07998657226562, 465.6990966796875, 254.98399353027344), 12),
('EXPIRATION DATE', (500.9939880371094, 247.07998657226562, 572.9221801757812, 254.98399353027344), 12),
('1', (339.1499938964844, 260.3299865722656, 343.5979919433594, 268.2339782714844), 12),
('6/28/2021', (416.2049865722656, 260.5799865722656, 451.7729187011719, 268.4839782714844), 12),
('7/28/2021', (519.7050170898438, 260.5799865722656, 555.27294921875, 268.4839782714844), 12),
('CANCELLATION REQUEST (Policy attached)', (30.0, 275.2779846191406, 221.3398895263672, 284.1159973144531), 12), (
'POLICY RELEASE (Complete Statement Section Below)', (306.0, 275.2779846191406, 543.7979736328125, 284.1159973144531),
12), ('POLICY RELEASE STATEMENT', (231.93800354003906, 291.66998291015625, 382.89813232421875, 301.489990234375), 12),
('The undersigned agrees that', (71.25, 310.8299865722656, 173.489990234375, 318.7339782714844), 12), (
'The above referenced policy is lost, destroyed or being retained.',
(184.5, 310.8299865722656, 412.0440673828125, 318.7339782714844), 12), (
'No claims of any type will be made against the Insurance Company, its agents or',
(184.5, 329.2283935546875, 470.66802978515625, 337.13238525390625), 12),
('7/12/2021', (503.0, 350.5, 547.47998046875, 364.239990234375), 12),
('WITNESS', (97.27729797363281, 377.0799865722656, 133.68528747558594, 384.9839782714844), 12),
('DATE', (221.83200073242188, 377.0799865722656, 243.1520233154297, 384.9839782714844), 12),
('SIGNATURE OF NAMED INSURED', (311.8280029296875, 377.0799865722656, 441.0440979003906, 384.9839782714844), 12),
('DATE', (515.8319702148438, 377.0799865722656, 537.1520385742188, 384.9839782714844), 12),
('WITNESS', (97.27729797363281, 415.0799865722656, 133.68528747558594, 422.9839782714844), 12),
('DATE', (221.83200073242188, 415.0799865722656, 243.1520233154297, 422.9839782714844), 12),
('SIGNATURE OF NAMED INSURED', (311.8280029296875, 415.0799865722656, 441.0440979003906, 422.9839782714844), 12),
('DATE', (515.8319702148438, 415.0799865722656, 537.1520385742188, 422.9839782714844), 12),
('AUTHORIZED SIGNATURE        TITLE', (315.27099609375, 445.9800109863281, 455.55096435546875, 453.8840026855469), 12),
('DATE', (515.8319702148438, 445.9800109863281, 537.1520385742188, 453.8840026855469), 12),
('LIEN HOLDER', (70.05000305175781, 447.0299987792969, 123.3539810180664, 454.9339904785156), 12),
('MORTGAGEE', (151.8000030517578, 447.0299987792969, 203.76002502441406, 454.9339904785156), 12),
('LOSSPAYEE', (232.8000030517578, 447.0299987792969, 280.7680358886719, 454.9339904785156), 12),
('FOR AGENCY / COMPANY USE', (36.0, 464.2779846191406, 170.38800048828125, 473.1159973144531), 12),
('REASON FOR CANCELLATION', (66.75, 479.7779846191406, 200.1299591064453, 488.6159973144531), 12),
('METHOD OF CANCELLATION', (375.0, 479.7779846191406, 502.3769226074219, 488.6159973144531), 12),
('NOT TAKEN', (40.79999923706055, 492.7829895019531, 86.52798461914062, 500.6869812011719), 12),
('OTHER (Identity)', (196.8000030517578, 494.9830017089844, 258.0880432128906, 502.8869934082031), 12),
('FLAT', (315.29998779296875, 494.9830017089844, 334.843994140625, 502.8869934082031), 12),
('FULL TERM', (419.25, 498.3299865722656, 463.6660461425781, 506.2339782714844), 12),
('$', (522.0, 500.0799865722656, 526.447998046875, 507.9839782714844), 12),
('REQUESTED BY INSURED', (40.79999923706055, 505.7829895019531, 141.59996032714844, 513.68701171875), 12),
('SHORT RATE', (315.29998779296875, 505.7829895019531, 366.81201171875, 513.68701171875), 12),
('PREMIUM', (419.25, 507.5292053222656, 457.0020446777344, 515.4332275390625), 12),
('REWRITTEN', (40.79999923706055, 515.8569946289062, 88.30399322509766, 523.760986328125), 12),
('PRO RATA', (315.29998779296875, 516.5830688476562, 356.1559753417969, 524.487060546875), 12),
('$', (522.0, 522.3300170898438, 526.447998046875, 530.2340087890625), 12),
('UNEARNED', (419.25, 522.3300170898438, 464.1141052246094, 530.2340087890625), 12),
('(Complete below)', (40.79999923706055, 525.0562133789062, 103.4639892578125, 532.960205078125), 12),
('PREMIUM COLLECTION', (315.29998779296875, 530.3810424804688, 406.3480224609375, 538.2850341796875), 12),
('FACTOR', (419.25, 531.5292358398438, 452.10601806640625, 539.4332275390625), 12),
('SUBJECT TO AUDIT', (315.29998779296875, 539.5806274414062, 391.22802734375, 547.484619140625), 12),
('COMPANY', (30.0, 543.3300170898438, 70.42400360107422, 551.2340087890625), 12),
('RETURN', (418.5, 546.3300170898438, 451.8120422363281, 554.2340087890625), 12),
('$', (522.75, 547.0800170898438, 527.197998046875, 554.9840087890625), 12),
('PREMIUM', (418.5, 555.5292358398438, 456.2520446777344, 563.4332275390625), 12),
('POLICY', (27.75, 559.8300170898438, 57.06999969482422, 567.7340087890625), 12),
('EFFECTIVE', (169.5, 560.5800170898438, 213.4520263671875, 568.4840087890625), 12),
('NUMBER', (27.75, 569.0292358398438, 62.398006439208984, 576.9332275390625), 12),
('DATE', (169.5, 569.7792358398438, 190.82000732421875, 577.6832275390625), 12),
('REMARKS', (27.75, 585.3300170898438, 67.2860107421875, 593.2340087890625), 12), (
'New York Only: If you do not keep auto insurance in force during the entire registration period, your motor vehicle registration will be suspended. If your',
(29.25, 601.8300170898438, 563.8020629882812, 609.7340087890625), 12), (
"vehicle is still uninsured after 90 days, your driver's license will be suspended. To avoid penalties, you must surrender your registration certificate and plates",
(29.25, 611.0292358398438, 580.0179443359375, 618.9332275390625), 12), (
'before your insurance expires. By law, we must report the termination of auto isurance coverage to the Department of Motor Vehicles.',
(29.25, 620.2284545898438, 501.593994140625, 628.1324462890625), 12),
('NAME AND ADDRESS', (36.0, 638.4779663085938, 130.9499969482422, 647.3159790039062), 12),
('REQUEST / RELEASE DISTRIBUTION', (360.0, 638.4779663085938, 519.8311157226562, 647.3159790039062), 12),
('INSURED', (304.79998779296875, 659.8309936523438, 340.7760009765625, 667.7349853515625), 12),
('LOSS PAYEE', (457.79998779296875, 659.8309936523438, 507.9840393066406, 667.7349853515625), 12),
('MORTGAGEE', (304.79998779296875, 670.6310424804688, 356.760009765625, 678.5350341796875), 12),
('LIEN HOLDER', (457.79998779296875, 670.6310424804688, 511.1040344238281, 678.5350341796875), 12),
('COMPANY', (304.79998779296875, 681.4310302734375, 345.2239990234375, 689.3350219726562), 12),
('FINANCE COMPANY', (457.79998779296875, 681.4310302734375, 535.5201416015625, 689.3350219726562), 12),
('DATE', (522.0, 696.077880859375, 546.4889526367188, 704.9158935546875), 12),
("PRODUCER's SIGNATURE", (300.0, 696.077880859375, 414.0659484863281, 704.9158935546875), 12),
('*124 *MIL49716', (252.0, 751.6875, 533.760498046875, 788.6257934570312), 12),
('MIL4971680 - PATRICIA LOPEZ', (10.152000427246094, 760.3201293945312, 126.98397064208984, 768.22412109375), 12),
('AU APP (01/19) – Copyright', (10.152000427246094, 768.6002197265625, 110.1199951171875, 776.5042114257812), 12),
('Page 13 of 15', (184.75399780273438, 774.7201538085938, 234.530029296875, 782.6241455078125), 12), (
'Alliance United Insurance Company', (10.152000427246094, 777.799072265625, 137.26400756835938, 785.7030639648438), 12))


async def test_get_cancellation_request_signature_placeholder():
    f = open(valid_file, "rb")
    file = io.BytesIO(f.read())
    obj = alliance_united.APPAllianceUnitedDataPointExtractorV1(uuid=uuid, file=file)
    metadata = page_metadata
    page_number = 12
    response = (296.5280029296875, 337.4799865722656, 480.8240979003906, 427.7519782714844)
    x = await obj._APPAllianceUnitedDataPointExtractorV1__get_cancellation_request_signature_placeholder(metadata,
                                                                                                         page_number)
    assert x == response


async def test_get_cancellation_request_date_placeholder():
    f = open(valid_file, "rb")
    file = io.BytesIO(f.read())
    obj = alliance_united.APPAllianceUnitedDataPointExtractorV1(uuid=uuid, file=file)
    metadata = page_metadata
    page_number = 12
    response = (479.1119702148437, 337.4799865722656, 576.9320385742187, 427.7519782714844)
    x = await obj._APPAllianceUnitedDataPointExtractorV1__get_cancellation_request_date_placeholder(metadata,
                                                                                                    page_number)
    assert x == response


async def test_get_parsed_date_bbox():
    f = open(valid_file, "rb")
    file = io.BytesIO(f.read())
    obj = alliance_united.APPAllianceUnitedDataPointExtractorV1(uuid=uuid, file=file)
    metadata = page_metadata
    response = (503.0, 350.5, 547.47998046875, 364.239990234375)
    x = await obj._APPAllianceUnitedDataPointExtractorV1__get_parsed_date_bbox(metadata)
    assert x == response


async def test_get_cancellation_request_signature_valid():
    f = open(valid_file, "rb")
    file = io.BytesIO(f.read())
    obj = alliance_united.APPAllianceUnitedDataPointExtractorV1(uuid=uuid, file=file)
    response = {'is_signed': True, 'is_dated': True}
    x = await obj._APPAllianceUnitedDataPointExtractorV1__get_cancellation_request_signature()
    assert x == response


async def test_get_cancellation_request_signature_invalid():
    f = open(invalid_file, "rb")
    file = io.BytesIO(f.read())
    obj = alliance_united.APPAllianceUnitedDataPointExtractorV1(uuid=uuid, file=file)
    x = await obj._APPAllianceUnitedDataPointExtractorV1__get_cancellation_request_signature()
    assert not x
